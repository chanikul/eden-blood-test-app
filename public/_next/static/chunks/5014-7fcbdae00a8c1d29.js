"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5014],{15014:function(e,r,t){t.d(r,{d:function(){return O}});var n,s,o=t(87022),a=t(99891),c=t(56952),l=t.n(c),i=t(20955),u=t(21822),d=t(23239),f=t(78063),p=t(63715),b=t(74530),m=t(31541),g=t(56345),h=t(71424),y=t(35944),v=t(26705);function j(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function O(e){var r,t=e.orderId,n=e.bloodTestId,c=e.clientId,O=e.testName,w=e.existingResultId,x=e.onSuccess,N=(0,i.useState)(null),P=N[0],k=N[1],E=(0,i.useState)(s.processing),S=E[0],I=E[1],Z=(0,i.useState)(!1),D=Z[0],R=Z[1],U=(0,i.useState)(!1),F=U[0],T=U[1],A=(0,i.useState)(null),C=A[0],J=A[1],_=(r=(0,a.Z)(l().mark(function e(r){var a,i,u,d,f,p;return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.preventDefault(),!(!P&&S!==s.processing)){e.next=4;break}return J("Please select a file to upload"),e.abrupt("return");case 4:if(e.prev=4,R(!0),J(null),a=null,!P){e.next=25;break}return e.prev=9,i="".concat(t,".pdf"),u="".concat(c,"/").concat(i),console.log("Preparing to upload file for client ".concat(c,", order ").concat(t)),e.next=15,(0,g.cT)(P,u);case 15:if(a=e.sent){e.next=18;break}throw Error("File upload completed but no URL was returned");case 18:console.log("File uploaded successfully, URL: ".concat(a)),e.next=25;break;case 21:throw e.prev=21,e.t0=e.catch(9),console.error("Error uploading test result file:",e.t0),Error("Failed to upload file: ".concat(e.t0 instanceof Error?e.t0.message:"Unknown error"));case 25:return d=w?"/api/test-results/".concat(w):"/api/test-results",f=w?"PATCH":"POST",e.next=29,fetch(d,{method:f,headers:{"Content-Type":"application/json"},body:JSON.stringify(function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?j(Object(t),!0).forEach(function(r){(0,o.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):j(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}({orderId:t,bloodTestId:n,clientId:c,status:S},a&&{resultUrl:a}))});case 29:if(e.sent.ok){e.next=32;break}throw Error("Failed to save test result");case 32:T(!0),S===s.ready?h.Am.success("Test result saved and notification email sent to client"):h.Am.success("Test result saved successfully"),x&&x(),e.next=44;break;case 37:e.prev=37,e.t1=e.catch(4),console.error("Error uploading test result:",e.t1),console.error("Error type:",Object.prototype.toString.call(e.t1)),console.error("Error stringified:",JSON.stringify(e.t1,Object.getOwnPropertyNames(e.t1))),e.t1 instanceof Error?(console.error("Error stack:",e.t1.stack),console.error("Error name:",e.t1.name),console.error("Error message:",e.t1.message),e.t1.message.includes("Failed to upload file")?J("Storage error: ".concat(e.t1.message)):e.t1.message.includes("Failed to save test result")?J("API error: Could not save the test result to the database"):J("Error: ".concat(e.t1.message))):"object"==typeof e.t1&&null!==e.t1?(p=e.t1.message||e.t1.error||JSON.stringify(e.t1),J("Unknown error object: ".concat(p))):J("An unknown error occurred while uploading the test result"),h.Am.error("Test result upload failed");case 44:return e.prev=44,R(!1),e.finish(44);case 47:case"end":return e.stop()}},e,null,[[4,37,44,47],[9,21]])})),function(e){return r.apply(this,arguments)});return(0,v.jsxs)("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200 p-6",children:[(0,v.jsxs)("div",{className:"mb-4",children:[(0,v.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:["Test Result for ",O]}),(0,v.jsx)("p",{className:"text-sm text-gray-500",children:"Upload test results and set status"})]}),(0,v.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,v.jsxs)("div",{className:"space-y-2",children:[(0,v.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Result Status"}),(0,v.jsxs)(d.P,{id:"status",value:S,onChange:function(e){return I(e.target.value)},disabled:D,children:[(0,v.jsx)("option",{value:s.processing,children:"Processing"}),(0,v.jsx)("option",{value:s.ready,children:"Ready"})]})]}),(0,v.jsxs)("div",{className:"space-y-2",children:[(0,v.jsx)("label",{htmlFor:"file",className:"block text-sm font-medium text-gray-700",children:"Result PDF (required for Ready status)"}),(0,v.jsx)(u.I,{id:"file",type:"file",accept:"application/pdf",onChange:function(e){var r,t=null===(r=e.target.files)||void 0===r?void 0:r[0];if(t){if("application/pdf"!==t.type){J("Please upload a PDF file"),k(null);return}k(t),J(null)}},disabled:D,className:"cursor-pointer"}),P&&(0,v.jsxs)("p",{className:"text-sm text-gray-500",children:["Selected: ",P.name]}),(0,v.jsxs)(y.bZ,{variant:"info",className:"bg-blue-50 text-blue-800 text-sm",children:[(0,v.jsx)(f.Z,{className:"h-4 w-4"}),(0,v.jsx)(y.X,{children:"When marked as Ready, an email notification (without attachment) will be sent to the client with instructions to view results securely in their dashboard."})]})]}),C&&(0,v.jsx)("p",{className:"text-sm text-red-500",children:C}),(0,v.jsx)("div",{className:"pt-4",children:(0,v.jsx)("button",{type:"submit",disabled:D||F||S===s.ready&&!P&&!w,className:"w-full inline-flex justify-center items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ".concat(D||F?"bg-teal-500":"bg-teal-600 hover:bg-teal-700"," focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500"),children:D?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(p.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):F?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"Saved"]}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),w?"Update Result":"Upload Result"]})})})]})]})}(n=s||(s={})).processing="processing",n.ready="ready"},35944:function(e,r,t){t.d(r,{X:function(){return g},bZ:function(){return m}});var n=t(87022),s=t(92184),o=t(20955),a=t(96061),c=t(40176),l=t(26705),i=["className","variant"],u=["className"],d=["className"];function f(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function p(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?f(Object(t),!0).forEach(function(r){(0,n.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):f(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var b=(0,a.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",success:"border-green-500/50 text-green-700 dark:border-green-500 [&>svg]:text-green-500",info:"border-blue-500/50 text-blue-700 dark:border-blue-500 [&>svg]:text-blue-500",warning:"border-yellow-500/50 text-yellow-700 dark:border-yellow-500 [&>svg]:text-yellow-500"}},defaultVariants:{variant:"default"}}),m=o.forwardRef(function(e,r){var t=e.className,n=e.variant,o=(0,s.Z)(e,i);return(0,l.jsx)("div",p({ref:r,role:"alert",className:(0,c.cn)(b({variant:n}),t)},o))});m.displayName="Alert",o.forwardRef(function(e,r){var t=e.className,n=(0,s.Z)(e,u);return(0,l.jsx)("h5",p({ref:r,className:(0,c.cn)("mb-1 font-medium leading-none tracking-tight",t)},n))}).displayName="AlertTitle";var g=o.forwardRef(function(e,r){var t=e.className,n=(0,s.Z)(e,d);return(0,l.jsx)("div",p({ref:r,className:(0,c.cn)("text-sm [&_p]:leading-relaxed",t)},n))});g.displayName="AlertDescription"},21822:function(e,r,t){t.d(r,{I:function(){return i}});var n=t(87022),s=t(92184),o=t(20955),a=t(26705),c=["className","error"];function l(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}var i=(0,o.forwardRef)(function(e,r){var t=e.className,o=void 0===t?"":t,i=e.error,u=(0,s.Z)(e,c);return(0,a.jsx)("input",function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?l(Object(t),!0).forEach(function(r){(0,n.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}({ref:r,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 ".concat(i?"border-red-500":""," ").concat(o)},u))});i.displayName="Input"},23239:function(e,r,t){t.d(r,{P:function(){return u}});var n=t(87022),s=t(92184),o=t(20955),a=t(26705),c=["className","error","children"];function l(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function i(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?l(Object(t),!0).forEach(function(r){(0,n.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var u=(0,o.forwardRef)(function(e,r){var t=e.className,n=void 0===t?"":t,o=e.error,l=e.children,u=(0,s.Z)(e,c);return(0,a.jsx)("select",i(i({ref:r,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 ".concat(o?"border-red-500":""," ").concat(n)},u),{},{children:l}))});u.displayName="Select"},56345:function(e,r,t){t.d(r,{Ng:function(){return i},cT:function(){return u}});var n=t(99891),s=t(56952),o=t.n(s),a=t(82857),c=t(62601).env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsemZobm53eXZkZGFvaWtydW5nIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0Njg4OTA2OCwiZXhwIjoyMDYyNDY1MDY4fQ.qbO0KymO7nLymwexLcZ2SK4n1owTDU5U63DoNoIygTE",l=null;function i(){return l||(l=(0,a.eI)("https://dlzfhnnwyvddaoikrung.supabase.co",c)),l}function u(e,r){return d.apply(this,arguments)}function d(){return(d=(0,n.Z)(o().mark(function e(r,t){var n,s,a,c,l,u=arguments;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>2&&void 0!==u[2]?u[2]:"test-results",e.prev=1,r){e.next=4;break}throw Error("No file provided for upload");case 4:if(t){e.next=6;break}throw Error("No storage path specified for upload");case 6:return console.log("Attempting to upload file to ".concat(n,"/").concat(t)),e.next=9,i().storage.from(n).upload(t,r,{cacheControl:"3600",upsert:!0});case 9:if(a=(s=e.sent).data,!(c=s.error)){e.next=15;break}throw console.error("Supabase upload error:",JSON.stringify(c)),Error("Error uploading file: ".concat(c.message));case 15:if(null!=a&&a.path){e.next=17;break}throw Error("Upload succeeded but no file path was returned");case 17:if(console.log("File uploaded successfully to ".concat(a.path)),null!=(l=i().storage.from(n).getPublicUrl(a.path).data)&&l.publicUrl){e.next=21;break}throw Error("Failed to generate public URL for uploaded file");case 21:return e.abrupt("return",l.publicUrl);case 24:throw e.prev=24,e.t0=e.catch(1),console.error("Error in uploadFile:",e.t0 instanceof Error?e.t0.message:"Unknown error"),console.error("Error details:",JSON.stringify(e.t0,null,2)),e.t0;case 29:case"end":return e.stop()}},e,null,[[1,24]])}))).apply(this,arguments)}},40176:function(e,r,t){t.d(r,{cn:function(){return o}});var n=t(57042),s=t(74769);function o(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.m6)((0,n.W)(r))}t(54131)}}]);