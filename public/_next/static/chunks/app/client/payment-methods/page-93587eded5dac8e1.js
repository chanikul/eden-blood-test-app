(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5226],{71121:function(e,t,r){Promise.resolve().then(r.bind(r,56500))},56500:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return k}});var s=r(87022),n=r(99891),a=r(56952),i=r.n(a),c=r(20955),l=r(71424),o=r(63715),d=r(71738),m=r(55340),h=r(45367),u=r(82549),p=r(26705);function x(e){switch(e.brand.toLowerCase()){case"visa":return(0,p.jsxs)("svg",{className:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",children:[(0,p.jsx)("path",{d:"M21.5 12c0-5.25-4.25-9.5-9.5-9.5S2.5 6.75 2.5 12s4.25 9.5 9.5 9.5 9.5-4.25 9.5-9.5z",fill:"#1A1F71"}),(0,p.jsx)("path",{d:"M10.4 14.6L8.7 9.4h1.4l1.1 3.4 1.1-3.4h1.4l-1.7 5.2h-1.6zm4.6 0V9.4h1.3v5.2H15zm-6.8 0L6.5 9.4h1.4l1.7 5.2H8.2z",fill:"white"})]});case"mastercard":return(0,p.jsxs)("svg",{className:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",children:[(0,p.jsx)("circle",{cx:"9",cy:"12",r:"7",fill:"#EB001B"}),(0,p.jsx)("circle",{cx:"15",cy:"12",r:"7",fill:"#F79E1B"}),(0,p.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 17.3a7 7 0 0 0 0-10.6 7 7 0 0 0 0 10.6z",fill:"#FF5F00"})]});case"amex":return(0,p.jsxs)("svg",{className:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",children:[(0,p.jsx)("rect",{width:"24",height:"24",rx:"4",fill:"#006FCF"}),(0,p.jsx)("path",{d:"M12.7 10.7h1.6l.8-1.9.8 1.9h1.6l-1.3-3 1.3-3h-1.6l-.8 1.9-.8-1.9h-1.6l1.3 3-1.3 3zm-6.4 0h2l.4-.9h2.2l.4.9h2.1L11 4.7H9L6.3 10.7zm2-2.2l.7-1.7.7 1.7H8.3z",fill:"white"})]});default:return(0,p.jsx)(d.Z,{className:"h-6 w-6 text-gray-400"})}}var f=r(77415),y=r(40176),j=r(29312),b=r(9224),v=r(83523),g=r(96974);function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach(function(t){(0,s.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function O(e){var t,r=e.onSuccess,s=e.shippingAddress,a=(0,c.useState)(!1),d=a[0],m=a[1],h=(0,c.useState)(!1),u=h[0],x=h[1],N=(0,c.useState)(""),O=N[0],C=N[1],D=(0,c.useState)("shipping"),S=D[0],k=D[1],A=(0,c.useState)(!1),P=A[0],F=A[1],E=(0,c.useState)({line1:"",city:"",postalCode:"",country:""}),_=E[0],M=E[1],Z=(0,g.useStripe)(),I=(0,g.useElements)(),z=(t=(0,n.Z)(i().mark(function e(t){var n,a,c,o,d,h,u;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!(!Z||!I)){e.next=4;break}return l.Am.error("Stripe not initialized"),e.abrupt("return");case 4:if(n=I.getElement(g.CardElement)){e.next=8;break}return l.Am.error("Card element not found"),e.abrupt("return");case 8:return x(!0),e.prev=9,a={name:O,address:"shipping"===S?s:{line1:_.line1,city:_.city,postal_code:_.postalCode,country:_.country||"GB"}},e.next=13,Z.createPaymentMethod({type:"card",card:n,billing_details:a});case 13:if(o=(c=e.sent).paymentMethod,!(d=c.error)){e.next=19;break}return l.Am.error(d.message),e.abrupt("return");case 19:if(!o){e.next=33;break}return h={paymentMethodId:o.id},"separate"===S&&(h.billingAddress=_),e.next=24,fetch("/api/payment-methods",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h),credentials:"include"});case 24:if((u=e.sent).ok){e.next=30;break}return e.next=28,u.json();case 28:throw Error(e.sent.error||"Failed to add payment method");case 30:l.Am.success("Payment method added successfully"),r(),m(!1);case 33:e.next=39;break;case 35:e.prev=35,e.t0=e.catch(9),l.Am.error(e.t0.message||"Failed to add payment method"),console.error(e.t0);case 39:return e.prev=39,x(!1),e.finish(39);case 42:case"end":return e.stop()}},e,null,[[9,35,39,42]])})),function(e){return t.apply(this,arguments)});return(0,p.jsxs)(f.Vq,{open:d,onOpenChange:m,children:[(0,p.jsx)(f.hg,{asChild:!0,children:(0,p.jsxs)(f.zx,{className:"bg-[#203749] hover:bg-[#203749]/90",children:[(0,p.jsx)(j.Z,{className:"w-4 h-4 mr-2"}),"Add Payment Method"]})}),(0,p.jsxs)(f.cZ,{className:"sm:max-w-[500px]","aria-describedby":"payment-method-description",children:[(0,p.jsx)("div",{id:"payment-method-description",className:"sr-only",children:"Add a new credit or debit card to your account for future payments"}),(0,p.jsx)(f.fK,{children:(0,p.jsx)(f.$N,{className:"text-[#203749]",children:"Add Payment Method"})}),(0,p.jsxs)("form",{onSubmit:z,className:"space-y-6",children:[(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)(f.__,{htmlFor:"card-element",children:"Card Information"}),(0,p.jsx)("div",{className:"mt-1 p-3 border rounded-md border-[#D4D3D2]",children:(0,p.jsx)(g.CardElement,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}},hidePostalCode:!0}})})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)(f.__,{htmlFor:"cardholderName",children:"Name on card"}),(0,p.jsx)(f.II,{id:"cardholderName",value:O,onChange:function(e){return C(e.target.value)},placeholder:"John Smith",required:!0})]}),(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsx)(f.__,{children:"Billing Address"}),(0,p.jsxs)(f.Ee,{value:S,onValueChange:function(e){k(e),"separate"===e&&F(!0)},className:"mt-2 space-y-2",children:[(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(f.mJ,{value:"shipping",id:"shipping"}),(0,p.jsx)(f.__,{htmlFor:"shipping",children:"Same as shipping address"})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(f.mJ,{value:"separate",id:"separate"}),(0,p.jsx)(f.__,{htmlFor:"separate",children:"Use a different billing address"})]})]})]}),(0,p.jsxs)(f.zF,{open:"separate"===S&&P,onOpenChange:F,className:(0,y.cn)("space-y-2 rounded-md","separate"===S?"block":"hidden"),children:[(0,p.jsx)(f.wy,{asChild:!0,children:(0,p.jsxs)(f.zx,{type:"button",variant:"secondary",className:"flex w-full justify-between p-4 font-normal",children:[(0,p.jsx)("span",{children:"Billing Address Details"}),P?(0,p.jsx)(b.Z,{className:"h-4 w-4"}):(0,p.jsx)(v.Z,{className:"h-4 w-4"})]})}),(0,p.jsx)(f.Fw,{className:"space-y-4 px-4",children:(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)(f.__,{htmlFor:"line1",children:"Address Line 1"}),(0,p.jsx)(f.II,{id:"line1",value:_.line1,onChange:function(e){return M(w(w({},_),{},{line1:e.target.value}))},className:"border-[#D4D3D2]",required:!0,placeholder:"123 Main St"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)(f.__,{htmlFor:"city",children:"City"}),(0,p.jsx)(f.II,{id:"city",value:_.city,onChange:function(e){return M(w(w({},_),{},{city:e.target.value}))},className:"border-[#D4D3D2]",required:!0,placeholder:"London"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)(f.__,{htmlFor:"postalCode",children:"Postcode"}),(0,p.jsx)(f.II,{id:"postalCode",value:_.postalCode,onChange:function(e){return M(w(w({},_),{},{postalCode:e.target.value}))},className:"border-[#D4D3D2]",required:!0,placeholder:"SW1A 1AA"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)(f.__,{htmlFor:"country",children:"Country"}),(0,p.jsx)(f.II,{id:"country",value:_.country||"GB",onChange:function(e){return M(w(w({},_),{},{country:e.target.value}))},className:"border-[#D4D3D2]",required:!0,defaultValue:"GB",readOnly:!0})]})]})})]})]}),(0,p.jsx)(f.zx,{type:"submit",className:"w-full bg-[#203749] hover:bg-[#203749]/90",disabled:u,children:u?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(o.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Adding payment method..."]}):"Add payment method"})]})]})]})}function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach(function(t){(0,s.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var S=(0,r(27106).J)("pk_test_51PfP96EaVUA3G0SJLrmjMFJMfSClLSNCNYW32uUQiRSOdXXjqVhSPMArcIKFR0CFY6w0pG7FwDmtBAT5GENjEgqd00YkY96lNm");function k(){var e,t,r,s,a=(0,c.useState)(!0),f=a[0],y=a[1],j=(0,c.useState)([]),b=j[0],v=j[1],N=(0,c.useState)(!1),w=N[0],C=N[1],k=(0,c.useState)(null),A=k[0],P=k[1],F=(e=(0,n.Z)(i().mark(function e(){var t;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/payment-methods");case 3:if((t=e.sent).ok){e.next=6;break}throw Error("Failed to fetch payment methods");case 6:return e.next=8,t.json();case 8:v(e.sent.paymentMethods),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),l.Am.error("Failed to load payment methods"),console.error(e.t0);case 16:return e.prev=16,y(!1),e.finish(16);case 19:case"end":return e.stop()}},e,null,[[0,12,16,19]])})),function(){return e.apply(this,arguments)});(0,c.useEffect)(function(){F()},[]);var E=(t=(0,n.Z)(i().mark(function e(t){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isDefault){e.next=2;break}return e.abrupt("return");case 2:P(t),C(!0);case 4:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),_=(r=(0,n.Z)(i().mark(function e(){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(A){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,fetch("/api/payment-methods",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentMethodId:A.id})});case 5:if(e.sent.ok){e.next=8;break}throw Error("Failed to remove payment method");case 8:v(function(e){return e.filter(function(e){return e.id!==A.id})}),C(!1),P(null),l.Am.success("Payment method removed successfully"),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(2),l.Am.error("Failed to remove payment method"),console.error(e.t0);case 18:case"end":return e.stop()}},e,null,[[2,14]])})),function(){return r.apply(this,arguments)}),M=(s=(0,n.Z)(i().mark(function e(t){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/payment-methods/default",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentMethodId:t})});case 3:if(e.sent.ok){e.next=6;break}throw Error("Failed to set default payment method");case 6:v(function(e){return e.map(function(e){return D(D({},e),{},{isDefault:e.id===t})})}),l.Am.success("Default payment method updated"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),l.Am.error("Failed to update default payment method"),console.error(e.t0);case 14:case"end":return e.stop()}},e,null,[[0,10]])})),function(e){return s.apply(this,arguments)});return(0,p.jsxs)("div",{className:"max-w-3xl mx-auto",children:[f?(0,p.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,p.jsx)(o.Z,{className:"h-8 w-8 animate-spin text-[#203749]"})}):(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{className:"md:flex md:items-center md:justify-between mb-6",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Payment Methods"}),(0,p.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Add and manage your payment methods"})]}),(0,p.jsx)("div",{className:"mt-4 md:mt-0",children:(0,p.jsx)(g.Elements,{stripe:S,children:(0,p.jsx)(O,{onSuccess:F})})})]}),0===b.length?(0,p.jsxs)("div",{className:"text-center py-12",children:[(0,p.jsx)(d.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,p.jsx)("h3",{className:"mt-2 text-sm font-semibold text-gray-900",children:"No payment methods"}),(0,p.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Add a payment method to get started"})]}):(0,p.jsx)("div",{className:"mt-6 space-y-4",children:b.map(function(e){var t,r,s,n,a;return(0,p.jsxs)("div",{className:"flex items-center justify-between p-4 bg-white border rounded-lg shadow-sm hover:shadow-md transition-shadow",children:[(0,p.jsxs)("div",{className:"flex items-center space-x-3",children:[(t=e.brand,(0,p.jsx)(x,{brand:t})),(0,p.jsxs)("div",{children:[(0,p.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:[e.brand.charAt(0).toUpperCase()+e.brand.slice(1),(0,p.jsxs)("span",{className:"mx-1",children:["•••• ",e.last4]}),e.isDefault&&(0,p.jsx)("span",{className:"ml-2 text-xs bg-teal-100 text-teal-800 px-2 py-0.5 rounded-full",children:"Default"})]}),(0,p.jsxs)("p",{className:"text-sm text-gray-500",children:["Expires ",(r=e.expMonth,s=e.expYear,"".concat(r.toString().padStart(2,"0"),"/").concat(s.toString().slice(-2))),(n=e.expMonth,a=e.expYear,new Date>new Date(a,n)&&(0,p.jsx)("span",{className:"ml-2 text-xs text-red-600",children:"Expired"}))]})]})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[!e.isDefault&&(0,p.jsx)("button",{onClick:function(){return M(e.id)},className:"p-1 text-gray-400 hover:text-[#203749] transition-colors",title:"Set as default",children:(0,p.jsx)(m.Z,{className:"h-5 w-5"})}),e.isDefault&&(0,p.jsx)(m.Z,{className:"h-5 w-5 text-[#203749] fill-current"}),(0,p.jsx)("button",{onClick:function(){return E(e)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:e.isDefault,title:e.isDefault?"Cannot delete default payment method":"Delete payment method",children:(0,p.jsx)(h.Z,{className:"h-5 w-5"})})]})]},e.id)})})]}),w&&(0,p.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4",children:(0,p.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[(0,p.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,p.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Remove Payment Method"}),(0,p.jsx)("button",{onClick:function(){return C(!1)},className:"text-gray-400 hover:text-gray-500",children:(0,p.jsx)(u.Z,{className:"h-5 w-5"})})]}),(0,p.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Are you sure you want to remove this payment method? This action cannot be undone."}),(0,p.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,p.jsx)("button",{onClick:function(){return C(!1)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),(0,p.jsx)("button",{onClick:_,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700",children:"Remove"})]})]})})]})}}},function(e){e.O(0,[8218,5350,2571,6107,7973,8329,3262,7415,4121,6531,1744],function(){return e(e.s=71121)}),_N_E=e.O()}]);