(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{71738:function(e,r,t){"use strict";t.d(r,{Z:function(){return n}});var s=t(65531);let n=(0,s.Z)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},12263:function(e,r,t){Promise.resolve().then(t.bind(t,3615))},3615:function(e,r,t){"use strict";t.r(r),t.d(r,{OrderForm:function(){return C}});var s=t(87022),n=t(70599),i=t(99891),a=t(56952),o=t.n(a),c=t(20955),l=t(63715),d=t(65531);let u=(0,d.Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var p=t(71738),m=t(61865),h=t(38110),f=t(24033),g=t(3449),_=t(71424),b=t(63106),x=t.n(b),y=t(40176),v=t(24748),j=t(69253),N=t.n(j),S=t(26705),w=["places"];function A(e){var r=e.onAddressSelect,t=e.defaultValue,s=e.error,n=(0,v.Db)({googleMapsApiKey:"AIzaSyCH6uYU2UByFtgEfrozg3j9PkOCnimKvsc",libraries:w}),i=n.isLoaded,a=n.loadError,o=(0,c.useRef)(null),l=(0,c.useRef)(null);return((0,c.useEffect)(function(){if(i&&o.current){var e="AIzaSyCH6uYU2UByFtgEfrozg3j9PkOCnimKvsc";console.log("Google Maps API Key available:",e?"Yes":"No"),e&&console.log("API Key starts with:",e.substring(0,4)+"...");try{l.current=new google.maps.places.Autocomplete(o.current,{componentRestrictions:{country:"gb"},fields:["address_components"],types:["address"]}),l.current.addListener("place_changed",function(){if(l.current){var e=l.current.getPlace();if(e.address_components){var t=e.address_components,s={line1:"",line2:"",city:"",state:"",postalCode:"",country:""};t.forEach(function(e){var r=e.types[0];"street_number"===r?s.line1=e.long_name:"route"===r?s.line1=s.line1?"".concat(s.line1," ").concat(e.long_name):e.long_name:"postal_town"===r||"locality"===r?s.city=e.long_name:"administrative_area_level_1"===r?s.state=e.long_name:"postal_code"===r?s.postalCode=e.long_name:"country"===r&&(s.country=e.long_name)}),r(s)}}})}catch(e){console.error("Error initializing Google Maps:",e)}return function(){l.current&&google.maps.event.clearInstanceListeners(l.current)}}},[i,r]),a)?(console.error("Error loading Google Maps:",a),(0,S.jsx)("div",{children:"Error loading Google Maps"})):(0,S.jsxs)("div",{className:"".concat(N().container," ").concat(N().autocompleteWrapper),children:[(0,S.jsx)("input",{ref:o,type:"text",defaultValue:t,placeholder:"Start typing your address...",className:N().input,disabled:!i}),s&&(0,S.jsx)("span",{className:N().error,children:s})]})}function O(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,s)}return t}function F(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?O(Object(t),!0).forEach(function(r){(0,s.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):O(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var k=[{id:"patient-info",title:"Patient Information",description:"We need your details to prepare your test kit"},{id:"test-selection",title:"Select Blood Test",description:"Choose from our range of comprehensive blood tests"},{id:"shipping",title:"Shipping Address",description:"Where should we send your test kit?"},{id:"account",title:"Create Account",description:"Create an account to track your orders and results"},{id:"review",title:"Review & Pay",description:"Review your order before payment"}],P=g.z.object({patientName:g.z.string().min(1,"Name is required"),patientEmail:g.z.string().email("Invalid email address"),patientDateOfBirth:g.z.string().min(1,"Date of birth is required"),patientMobile:g.z.string().optional(),testSlug:g.z.string().min(1,"Please select a test"),notes:g.z.string().optional(),createAccount:g.z.boolean().default(!1),password:g.z.string().optional().refine(function(e){return!e||e.length>=8},{message:"Password must be at least 8 characters"}),shippingAddress:g.z.object({line1:g.z.string().min(1,"Street address is required"),line2:g.z.string().optional(),city:g.z.string().min(1,"City is required"),state:g.z.string().optional(),postalCode:g.z.string().min(1,"Postal code is required"),country:g.z.string().min(1,"Country is required")})});function C(){var e,r,t,a,d,g,b=(0,c.useState)(0),v=b[0],j=b[1],N=(0,c.useState)(!1),w=N[0],O=N[1],C=(0,c.useState)([]),E=C[0],I=C[1],z=(0,c.useState)([]),D=z[0],B=z[1];(0,f.useRouter)();var G=(0,m.cI)({resolver:(0,h.F)(P),mode:"onBlur",defaultValues:{patientName:"",patientEmail:"",patientDateOfBirth:"",patientMobile:"",testSlug:"",notes:"",createAccount:!1,password:"",shippingAddress:{line1:"",line2:"",city:"",state:"",postalCode:"",country:""}}}),T=(0,c.useMemo)(function(){var e=G.watch("testSlug");return null==E?void 0:E.find(function(r){return r.slug===e})},[E,G.watch("testSlug")]);function M(){return(M=(0,i.Z)(o().mark(function e(){var r,t,s,n;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,O(!0),e.next=4,fetch("/api/products");case 4:if((r=e.sent).ok){e.next=7;break}throw Error("Failed to fetch blood tests");case 7:return e.next=9,r.json();case 9:if(!Array.isArray(t=e.sent)){e.next=18;break}console.log("Blood test products with type=blood_test:",s=t.filter(function(e){return e.metadata&&"blood_test"===e.metadata.type})),console.log("Formatted blood tests for form:",n=s.map(function(e){return{id:e.id,name:e.name,description:e.description||"",price:e.price,stripePriceId:e.priceId||"",isActive:!1!==e.active,slug:e.slug}})),I(n),e.next=19;break;case 18:throw Error("Invalid response format");case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(0),console.error("Error fetching blood tests:",e.t0),_.Am.error("Failed to load blood tests");case 25:return e.prev=25,O(!1),e.finish(25);case 28:case"end":return e.stop()}},e,null,[[0,21,25,28]])}))).apply(this,arguments)}(0,c.useEffect)(function(){!function(){M.apply(this,arguments)}()},[]);var Z=(e=(0,i.Z)(o().mark(function e(r){var t,s;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(e){switch(e){case 0:return["patientName","patientEmail","patientDateOfBirth","patientMobile"];case 1:return["testSlug","notes"];case 2:return["shippingAddress"];case 3:return["createAccount","password"];default:return[]}}(r),e.next=3,G.trigger(t);case 3:return s=e.sent,e.abrupt("return",s);case 5:case"end":return e.stop()}},e)})),function(r){return e.apply(this,arguments)}),L=(r=(0,i.Z)(o().mark(function e(){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z(v);case 2:e.sent&&v<k.length-1&&(j(v+1),B([].concat((0,n.Z)(D),[v])));case 4:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)}),H=(t=(0,i.Z)(o().mark(function e(r){var t,s,n,i;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,T){e.next=4;break}return _.Am.error("Please select a blood test"),e.abrupt("return");case 4:return O(!0),console.log("Full request data:",t={fullName:r.patientName,email:r.patientEmail,dateOfBirth:r.patientDateOfBirth,mobile:r.patientMobile,testSlug:T.slug,testName:T.name,stripePriceId:T.stripePriceId,price:T.price,productId:T.id,notes:r.notes,createAccount:r.createAccount,password:r.createAccount?r.password:void 0,shippingAddress:r.shippingAddress,successUrl:"".concat(window.location.origin,"/order-success"),cancelUrl:window.location.href}),console.log("Sending checkout request:",t),e.next=10,fetch("/api/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 10:return s=e.sent,e.next=13,s.json();case 13:if(n=e.sent,s.ok){e.next=17;break}throw console.error("Checkout API error:",{status:s.status,statusText:s.statusText,data:n}),Error(n.error||"Failed to create checkout session");case 17:if(n.url){e.next=19;break}throw Error("No checkout URL returned from the server");case 19:console.log("Redirecting to checkout:",n.url),window.location.href=n.url,e.next=28;break;case 23:e.prev=23,e.t0=e.catch(0),i=e.t0 instanceof Error?e.t0.message:"Something went wrong. Please try again.",_.Am.error(i),console.error("Checkout error:",e.t0);case 28:return e.prev=28,O(!1),e.finish(28);case 31:case"end":return e.stop()}},e,null,[[0,23,28,31]])})),function(e){return t.apply(this,arguments)});return w?(0,S.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,S.jsx)(l.Z,{className:"w-8 h-8 animate-spin text-primary"})}):(0,S.jsxs)("div",{className:x().formContainer,children:[(0,S.jsx)("div",{className:x().progressBar,children:k.map(function(e,r){var t;return(0,S.jsxs)("div",{className:x().progressStep,children:[(0,S.jsx)("div",{className:(0,y.cn)(x().stepIcon,(t={},(0,s.Z)(t,x().completed,D.includes(r)),(0,s.Z)(t,x().active,v===r),t)),children:D.includes(r)?(0,S.jsx)(u,{className:"w-5 h-5"}):(0,S.jsx)("span",{children:r+1})}),(0,S.jsxs)("div",{className:x().stepInfo,children:[(0,S.jsx)("div",{className:x().stepTitle,children:e.title}),(0,S.jsx)("div",{className:x().stepDescription,children:e.description})]})]},e.title)})}),(0,S.jsxs)("form",{onSubmit:G.handleSubmit(H),className:x().form,children:[0===v&&(0,S.jsxs)("div",{className:x().formSection,children:[(0,S.jsx)("h2",{className:x().formTitle,children:k[v].title}),(0,S.jsx)("p",{className:x().formSubtitle,children:k[v].description}),(0,S.jsxs)("div",{className:x().inputGroup,children:[(0,S.jsx)("label",{className:x().label,children:"Full Name"}),(0,S.jsx)("div",{className:x().inputHint,children:"Enter your name as it appears on your ID"}),(0,S.jsx)("input",F(F({type:"text",id:"patientName"},G.register("patientName")),{},{className:x().input})),G.formState.errors.patientName&&(0,S.jsx)("span",{className:x().error,children:G.formState.errors.patientName.message})]}),(0,S.jsxs)("div",{className:x().inputGroup,children:[(0,S.jsx)("label",{className:x().label,children:"Email Address"}),(0,S.jsx)("div",{className:x().inputHint,children:"We'll send your results and order updates here"}),(0,S.jsx)("input",F(F({type:"email",id:"patientEmail"},G.register("patientEmail")),{},{className:x().input})),G.formState.errors.patientEmail&&(0,S.jsx)("span",{className:x().error,children:G.formState.errors.patientEmail.message})]}),(0,S.jsxs)("div",{className:x().inputGroup,children:[(0,S.jsx)("label",{className:x().label,children:"Date of Birth"}),(0,S.jsx)("div",{className:x().inputHint,children:"Required by our clinicians to issue your prescription"}),(0,S.jsx)("input",F(F({type:"date",id:"patientDateOfBirth"},G.register("patientDateOfBirth")),{},{className:x().input})),G.formState.errors.patientDateOfBirth&&(0,S.jsx)("span",{className:x().error,children:G.formState.errors.patientDateOfBirth.message})]}),(0,S.jsxs)("div",{className:x().inputGroup,children:[(0,S.jsx)("label",{className:x().label,children:"Mobile Number"}),(0,S.jsx)("div",{className:x().inputHint,children:"For delivery updates and important notifications"}),(0,S.jsx)("input",F(F({type:"tel",id:"patientMobile"},G.register("patientMobile")),{},{className:x().input})),G.formState.errors.patientMobile&&(0,S.jsx)("span",{className:x().error,children:G.formState.errors.patientMobile.message})]})]}),1===v&&(0,S.jsxs)("div",{className:x().formSection,children:[(0,S.jsx)("h2",{className:x().formTitle,children:k[v].title}),(0,S.jsx)("p",{className:x().formSubtitle,children:k[v].description}),(0,S.jsxs)("div",{className:x().formGroup,children:[(0,S.jsx)("label",{className:x().label,children:"Select Blood Test"}),(0,S.jsx)("div",{className:x().inputHint,children:"Choose from our range of comprehensive blood tests"}),(0,S.jsxs)("select",F(F({},G.register("testSlug")),{},{className:x().select,onChange:function(e){G.setValue("testSlug",e.target.value),E.find(function(r){return r.slug===e.target.value})},children:[(0,S.jsx)("option",{value:"",children:"Select a test..."}),E.map(function(e){return(0,S.jsxs)("option",{value:e.slug,children:[e.name," - \xa3",e.price>0?e.price.toFixed(2):"TBD"]},e.id)})]})),G.formState.errors.testSlug&&(0,S.jsx)("span",{className:x().error,children:G.formState.errors.testSlug.message}),G.watch("testSlug")&&(0,S.jsx)("div",{className:x().selectedTestInfo,children:(a=E.find(function(e){return e.slug===G.watch("testSlug")}))?(0,S.jsx)("p",{className:x().testDescription,children:a.description}):null})]}),(0,S.jsxs)("div",{className:x().formGroup,children:[(0,S.jsx)("label",{className:x().label,htmlFor:"notes",children:"Additional Notes (Optional)"}),(0,S.jsx)("div",{className:x().inputHint,children:"Any specific requirements or information we should know"}),(0,S.jsx)("textarea",F(F({id:"notes"},G.register("notes")),{},{className:x().textarea,placeholder:"Enter any additional notes here..."}))]})]}),2===v&&(0,S.jsxs)("div",{className:x().formSection,children:[(0,S.jsx)("h2",{className:x().formTitle,children:k[v].title}),(0,S.jsx)("p",{className:x().formSubtitle,children:k[v].description}),(0,S.jsxs)("div",{className:x().formGroup,children:[(0,S.jsx)("label",{className:x().label,children:"Delivery Address"}),(0,S.jsx)("div",{className:x().inputHint,children:"Enter your address for test kit delivery"}),(0,S.jsx)(A,{onAddressSelect:function(e){G.setValue("shippingAddress.line1",e.line1),e.line2&&G.setValue("shippingAddress.line2",e.line2),G.setValue("shippingAddress.city",e.city),G.setValue("shippingAddress.state",e.state),G.setValue("shippingAddress.postalCode",e.postalCode),G.setValue("shippingAddress.country",e.country)},error:null===(d=G.formState.errors.shippingAddress)||void 0===d?void 0:null===(g=d.line1)||void 0===g?void 0:g.message})]}),G.watch("shippingAddress.line1")&&(0,S.jsxs)("div",{className:x().addressSummary,children:[(0,S.jsx)("div",{className:x().addressLine,children:G.watch("shippingAddress.line1")}),G.watch("shippingAddress.line2")&&(0,S.jsx)("div",{className:x().addressLine,children:G.watch("shippingAddress.line2")}),(0,S.jsxs)("div",{className:x().addressLine,children:[G.watch("shippingAddress.city"),G.watch("shippingAddress.state")&&", ".concat(G.watch("shippingAddress.state"))]}),(0,S.jsx)("div",{className:x().addressLine,children:G.watch("shippingAddress.postalCode")}),(0,S.jsx)("div",{className:x().addressLine,children:G.watch("shippingAddress.country")})]})]}),3===v&&(0,S.jsxs)("div",{className:x().formSection,children:[(0,S.jsx)("h2",{className:x().formTitle,children:k[v].title}),(0,S.jsx)("p",{className:x().formSubtitle,children:k[v].description}),(0,S.jsx)("div",{className:x().inputGroup,children:(0,S.jsxs)("div",{className:x().checkboxGroup,children:[(0,S.jsx)("input",F(F({type:"checkbox",id:"createAccount"},G.register("createAccount")),{},{className:x().checkbox})),(0,S.jsx)("label",{htmlFor:"createAccount",className:x().checkboxLabel,children:"Create an account to track your orders and access your results"})]})}),G.watch("createAccount")&&(0,S.jsxs)("div",{className:x().inputGroup,children:[(0,S.jsx)("label",{className:x().label,children:"Password"}),(0,S.jsx)("div",{className:x().inputHint,children:"Choose a secure password for your account"}),(0,S.jsx)("input",F(F({type:"password",id:"password"},G.register("password")),{},{className:x().input,placeholder:"Enter a secure password"})),G.formState.errors.password&&(0,S.jsx)("span",{className:x().error,children:G.formState.errors.password.message})]})]}),(0,S.jsxs)("div",{className:x().buttonGroup,children:[v>0&&(0,S.jsx)("button",{type:"button",onClick:function(){v>0&&j(v-1)},className:x().buttonSecondary,children:"Previous"}),v<k.length-1?(0,S.jsx)("button",{type:"button",onClick:L,className:x().buttonPrimary,children:"Next"}):(0,S.jsx)("button",{type:"submit",className:x().buttonPrimary,disabled:w,children:w?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(l.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(p.Z,{className:"w-4 h-4 mr-2"}),"Proceed to Payment"]})})]})]})]})}},40176:function(e,r,t){"use strict";t.d(r,{cn:function(){return i}});var s=t(57042),n=t(74769);function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n.m6)((0,s.W)(r))}t(54131)},69253:function(e){e.exports={container:"AddressAutocomplete_container__e1sm4",input:"AddressAutocomplete_input__CCA85",error:"AddressAutocomplete_error__Aprvb",autocompleteWrapper:"AddressAutocomplete_autocompleteWrapper__Z3txB"}},63106:function(e){e.exports={formContainer:"OrderForm_formContainer__Kx_ZN",progressBar:"OrderForm_progressBar__uWJXR",progressStep:"OrderForm_progressStep__7aIc2",stepIcon:"OrderForm_stepIcon__BrDmF",active:"OrderForm_active___PP7b",completed:"OrderForm_completed__u4rHn",stepInfo:"OrderForm_stepInfo__cPhFk",stepTitle:"OrderForm_stepTitle__dGfUJ",stepDescription:"OrderForm_stepDescription__W2tR6",select:"OrderForm_select__c3xRh",selectedTestInfo:"OrderForm_selectedTestInfo__ILbSW",testDescription:"OrderForm_testDescription___dzNk",formSection:"OrderForm_formSection__ud9C9",formTitle:"OrderForm_formTitle__8ziAd",formSubtitle:"OrderForm_formSubtitle__3yGzo",formGroup:"OrderForm_formGroup__qgBe5",checkbox:"OrderForm_checkbox__JEohf",checkboxLabel:"OrderForm_checkboxLabel__ihEJ_",inputGroup:"OrderForm_inputGroup__a2Y0i",label:"OrderForm_label__w99VS",inputHint:"OrderForm_inputHint__LTFbW",input:"OrderForm_input__UFCn0",error:"OrderForm_error__6bw4q",errorMessage:"OrderForm_errorMessage__t5fnJ",addressSummary:"OrderForm_addressSummary__oh5C2",addressLine:"OrderForm_addressLine__izgcm",buttonGroup:"OrderForm_buttonGroup__mS3_y",button:"OrderForm_button__KPQYF",buttonSecondary:"OrderForm_buttonSecondary__nvW6S OrderForm_button__KPQYF",buttonPrimary:"OrderForm_buttonPrimary____Uoi OrderForm_button__KPQYF"}},24033:function(e,r,t){e.exports=t(65367)},70599:function(e,r,t){"use strict";function s(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,s=Array(r);t<r;t++)s[t]=e[t];return s}function n(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,r){if(e){if("string"==typeof e)return s(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if("Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return s(e,r)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}t.d(r,{Z:function(){return n}})}},function(e){e.O(0,[8218,1910,5350,2571,6107,7973,2221,4121,6531,1744],function(){return e(e.s=12263)}),_N_E=e.O()}]);