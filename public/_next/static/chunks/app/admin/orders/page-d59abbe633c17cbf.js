(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8606],{10956:function(e,t,s){Promise.resolve().then(s.bind(s,25660)),Promise.resolve().then(s.bind(s,59232))},59232:function(e,t,s){"use strict";s.r(t),s.d(t,{OrderFiltersWrapper:function(){return x}});var r=s(24033),a=s(87022),n=s(20955),i=s(52170);s(3159);var l=s(26705);function d(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,r)}return s}function c(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?d(Object(s),!0).forEach(function(t){(0,a.Z)(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):d(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}var o={search:"",testType:"",status:"",dateRange:{start:null,end:null}};function u(e){var t,s,r,d=e.testTypes,u=e.initialFilters,x=e.onFilterChange,m=(0,n.useState)(u),p=m[0],h=m[1],g=(s=(t=(0,n.useState)(p))[0],r=t[1],(0,n.useEffect)(function(){var e=setTimeout(function(){r(p)},300);return function(){clearTimeout(e)}},[p,300]),s);(0,n.useEffect)(function(){x(g)},[g,x]);var f=function(e,t){h(c(c({},p),{},(0,a.Z)({},e,t)))};return(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-6 mb-6 z-10",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-lg font-medium text-gray-800",children:"Filter Orders"}),(p.search||p.testType||p.status||p.dateRange.start||p.dateRange.end)&&(0,l.jsxs)("button",{onClick:function(){h(o)},className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors flex items-center gap-1",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),"Clear All Filters"]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Search"}),(0,l.jsx)("input",{type:"text",placeholder:"Search by name or email",value:p.search,onChange:function(e){return f("search",e.target.value)},className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-gray-900 placeholder:text-gray-600"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Test Type"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("select",{value:p.testType,onChange:function(e){return f("testType",e.target.value)},className:"w-full appearance-none rounded-md border-gray-300 bg-white pl-3 pr-10 py-2 text-base text-gray-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-blue-500",children:[(0,l.jsx)("option",{value:"",className:"text-gray-900",children:"All Tests"}),d.map(function(e){return(0,l.jsx)("option",{value:e,className:"py-2 text-gray-900",children:e},e)})]}),(0,l.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Status"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("select",{value:p.status,onChange:function(e){return f("status",e.target.value)},className:"w-full appearance-none rounded-md border-gray-300 bg-white pl-3 pr-10 py-2 text-base text-gray-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-blue-500",children:[(0,l.jsx)("option",{value:"",className:"text-gray-900",children:"All Status"}),(0,l.jsx)("option",{value:"PENDING",className:"text-gray-900",children:"Pending"}),(0,l.jsx)("option",{value:"PAID",className:"text-gray-900",children:"Paid"}),(0,l.jsx)("option",{value:"DISPATCHED",className:"text-gray-900",children:"Dispatched"}),(0,l.jsx)("option",{value:"CANCELLED",className:"text-gray-900",children:"Cancelled"})]}),(0,l.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Date Range"}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)(i.ZP,{selected:p.dateRange.start,onChange:function(e){return f("dateRange",c(c({},p.dateRange),{},{start:e}))},selectsStart:!0,startDate:p.dateRange.start,endDate:p.dateRange.end,placeholderText:"Start Date",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white text-gray-900 placeholder:text-gray-400",dateFormat:"dd/MM/yyyy"}),(0,l.jsx)(i.ZP,{selected:p.dateRange.end,onChange:function(e){return f("dateRange",c(c({},p.dateRange),{},{end:e}))},selectsEnd:!0,startDate:p.dateRange.start,endDate:p.dateRange.end,placeholderText:"End Date",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white text-gray-900 placeholder:text-gray-400",dateFormat:"dd/MM/yyyy"})]})]})]})]})}function x(e){var t=e.testTypes,s=e.initialFilters,a=(0,r.useRouter)();return(0,l.jsx)(u,{testTypes:t,initialFilters:s,onFilterChange:function(e){var t,s,r,n=new URLSearchParams;null!==(t=e.search)&&void 0!==t&&t.trim()&&n.set("search",e.search.trim()),null!==(s=e.testType)&&void 0!==s&&s.trim()&&n.set("testType",e.testType.trim()),null!==(r=e.status)&&void 0!==r&&r.trim()&&n.set("status",e.status.trim()),e.dateRange.start&&n.set("startDate",e.dateRange.start.toISOString().split("T")[0]),e.dateRange.end&&n.set("endDate",e.dateRange.end.toISOString().split("T")[0]);var i=n.toString(),l="/admin/orders".concat(i?"?".concat(i):"");l!==window.location.pathname+window.location.search&&(a.replace(l),a.refresh())}})}},25660:function(e,t,s){"use strict";s.r(t),s.d(t,{OrdersTable:function(){return h}});var r,a,n=s(20955);(r=a||(a={})).PENDING="PENDING",r.PAID="PAID",r.DISPATCHED="DISPATCHED",r.CANCELLED="CANCELLED";var i=s(36335),l=s(99891),d=s(56952),c=s.n(d),o=s(24033),u=s(15014),x=s(71424),m=s(26705);function p(e){var t,s=e.order,r=e.onClose,d=(0,n.useState)((null==s?void 0:s.internalNotes)||""),p=d[0],h=d[1],g=(null==s?void 0:s.status)||a.PENDING,f=(0,n.useState)(g),y=f[0],b=f[1],j=(0,n.useState)(!1),v=j[0],N=j[1],w=(0,n.useState)(null),D=w[0],k=w[1],C=(0,o.useRouter)();if((0,n.useEffect)(function(){var e;(e=(0,l.Z)(c().mark(function e(){var t,r;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,fetch("/api/admin/orders/".concat(s.id,"/test-result"),{method:"GET"});case 5:if(!(t=e.sent).ok){e.next=11;break}return e.next=9,t.json();case 9:(r=e.sent).result&&k(r.result.id);case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("Error fetching test result:",e.t0);case 16:case"end":return e.stop()}},e,null,[[2,13]])})),function(){return e.apply(this,arguments)})()},[null==s?void 0:s.id]),!s)return null;var A=(t=(0,l.Z)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=3;break}return x.Am.error("No order to update"),e.abrupt("return");case 3:return e.prev=3,N(!0),e.next=7,fetch("/api/admin/orders/".concat(s.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:y,internalNotes:p})});case 7:if(e.sent.ok){e.next=10;break}throw Error("Failed to update order");case 10:if(!(y===a.DISPATCHED&&s.status!==a.DISPATCHED)){e.next=13;break}return e.next=13,fetch("/api/admin/orders/".concat(s.id,"/dispatch-notification"),{method:"POST"});case 13:x.Am.success("Order updated successfully"),C.refresh(),r(),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(3),console.error("Error updating order:",e.t0),x.Am.error("Failed to update order");case 22:return e.prev=22,N(!1),e.finish(22);case 25:case"end":return e.stop()}},e,null,[[3,18,22,25]])})),function(){return t.apply(this,arguments)});return(0,m.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,m.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6",children:[(0,m.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,m.jsx)("h2",{className:"text-2xl font-semibold text-gray-800",children:"Order Details"}),(0,m.jsxs)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700",children:[(0,m.jsx)("span",{className:"sr-only",children:"Close"}),"âœ•"]})]}),(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"Patient Information"}),(0,m.jsxs)("div",{className:"space-y-2",children:[(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Name:"})," ",s.patientName]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Date of Birth:"})," ",(0,i.ZP)(new Date(s.patientDateOfBirth),"dd/MM/yyyy")]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Email:"})," ",s.patientEmail]}),s.patientMobile&&(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Mobile:"})," ",s.patientMobile]})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"Order Details"}),(0,m.jsxs)("div",{className:"space-y-2",children:[(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Order ID:"})," ",s.id]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Test Type:"})," ",s.testName]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Patient Name:"})," ",s.patientName]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Date of Birth:"})," ",(0,i.ZP)(new Date(s.patientDateOfBirth),"dd/MM/yyyy")]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Email:"})," ",s.patientEmail]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium",children:"Order Date:"})," ",(0,i.ZP)(new Date(s.createdAt),"dd/MM/yyyy HH:mm")]}),s?(0,m.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[(0,m.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Shipping Address"}),s.shippingAddress?(0,m.jsxs)("div",{className:"space-y-3",children:[(0,m.jsx)("div",{className:"space-y-1 text-gray-800",children:function(){try{var e=null;if("string"==typeof s.shippingAddress?e=JSON.parse(s.shippingAddress):"object"==typeof s.shippingAddress&&null!==s.shippingAddress&&(e=s.shippingAddress),!e)return(0,m.jsx)("div",{children:"No shipping address provided"});return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"font-medium",children:e.line1}),e.line2&&(0,m.jsx)("div",{children:e.line2}),(0,m.jsx)("div",{children:[e.city,e.state].filter(Boolean).join(", ")}),(0,m.jsx)("div",{children:e.postal_code||e.postalCode}),(0,m.jsx)("div",{className:"font-medium",children:e.country})]})}catch(e){return console.error("Failed to parse shipping address:",e,"\nRaw value:",s.shippingAddress),(0,m.jsx)("div",{className:"text-red-500",children:"Error: Invalid address format"})}}()}),(0,m.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,m.jsxs)("div",{className:"text-xs font-mono text-gray-500 break-all",children:["Raw data: ","string"==typeof s.shippingAddress?s.shippingAddress:JSON.stringify(s.shippingAddress)]})})]}):(0,m.jsx)("div",{className:"text-gray-500 italic",children:"No shipping address recorded"})]}):null,(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium text-gray-800",children:"Stripe Session ID:"})," ",s.stripeSessionId||"N/A"]}),s.dispatchedAt&&(0,m.jsxs)("p",{children:[(0,m.jsx)("span",{className:"font-medium text-gray-800",children:"Dispatched:"})," ",(0,i.ZP)(new Date(s.dispatchedAt),"dd/MM/yyyy HH:mm")]})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"Test Results"}),(0,m.jsx)("div",{className:"mb-6",children:(0,m.jsx)(u.d,{orderId:s.id,bloodTestId:s.bloodTestId||"",clientId:s.clientId||"",testName:s.testName,existingResultId:D||void 0,onSuccess:function(){x.Am.success("Test result updated successfully"),C.refresh()}})})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"Update Status"}),(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,m.jsx)("select",{id:"status",value:y,onChange:function(e){var t=e.target.value;Object.values(a).includes(t)&&b(t)},className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",disabled:v,children:Object.values(a).map(function(e){return(0,m.jsx)("option",{value:e,children:e},e)})})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Internal Notes"}),(0,m.jsx)("textarea",{id:"notes",rows:4,value:p,onChange:function(e){return h(e.target.value)},className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",disabled:v,placeholder:"Add any internal notes here..."})]}),(0,m.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,m.jsx)("button",{type:"button",onClick:r,className:"bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",disabled:v,children:"Cancel"}),(0,m.jsx)("button",{type:"button",onClick:A,className:"bg-indigo-600 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",disabled:v,children:v?"Updating...":"Update Order"})]})]})]})]})]})})}function h(e){var t=e.orders,s=(0,n.useState)(null),r=s[0],l=s[1];return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:(0,m.jsx)("div",{className:"overflow-x-auto",children:(0,m.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,m.jsx)("thead",{className:"bg-gray-50",children:(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-800 uppercase tracking-wider",children:"Patient Name"}),(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-800 uppercase tracking-wider",children:"Test Type"}),(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-800 uppercase tracking-wider",children:"Date of Birth"}),(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-800 uppercase tracking-wider",children:"Email"}),(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-800 uppercase tracking-wider",children:"Status"}),(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-800 uppercase tracking-wider",children:"Order Date"}),(0,m.jsx)("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-800 uppercase tracking-wider",children:"Actions"})]})}),(0,m.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(function(e){return(0,m.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:function(){return l(e)},children:[(0,m.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-800 font-medium",children:e.patientName}),(0,m.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-800 font-medium",children:e.testName}),(0,m.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-800 font-medium",children:e.patientDateOfBirth}),(0,m.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-800 font-medium",children:e.patientEmail}),(0,m.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,m.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full\n                      ".concat(e.status===a.PAID?"bg-yellow-100 text-yellow-900":e.status===a.DISPATCHED?"bg-green-100 text-green-900":e.status===a.CANCELLED?"bg-red-100 text-red-900":"bg-gray-100 text-gray-900"),children:e.status})}),(0,m.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-800 font-medium",children:(0,i.ZP)(new Date(e.createdAt),"dd MMM yyyy, HH:mm")}),(0,m.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-800 font-medium",children:(0,m.jsx)("button",{className:"text-blue-700 hover:text-blue-900 font-medium",onClick:function(t){t.stopPropagation(),l(e)},children:"View Details"})})]},e.id)})})]})})}),(0,m.jsx)(p,{order:r,onClose:function(){return l(null)}})]})}}},function(e){e.O(0,[8218,282,2333,5350,2571,6107,2857,7973,8054,7136,9892,5014,4121,6531,1744],function(){return e(e.s=10956)}),_N_E=e.O()}]);